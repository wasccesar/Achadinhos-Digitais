<!DOCTYPE html>
<html class="dark" lang="pt-br" x-data="{ 
    modalOpen: false, 
    selectedUser: null, 
    searchTerm: '',
    filterProduto: 'todos',
    filterPeriodo: 'todos',
    filterStatus: 'todos',
    filterProdutoText: 'Produto',
    filterPeriodoText: 'Período',
    filterStatusText: 'Status',
    openProduto: false,
    openPeriodo: false,
    openStatus: false,
    isSidebarOpen: false 
}">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Gerenciar Clientes</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
<script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#d946ef",
                        "primary-light": "#332635",
                        "background-light": "#fdf8fd",
                        "background-dark": "#1a131a",
                    },
                    fontFamily: {
                        "display": ["Manrope", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            font-size: 24px;
        }
        body {
            min-height: 100dvh;
        }
    </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="bg-background-light dark:bg-background-dark font-display" :class="{ 'overflow-hidden': isSidebarOpen }">
<div class="relative flex min-h-screen w-full flex-col overflow-x-hidden">
<header class="sticky top-0 z-10 flex items-center justify-between border-b border-zinc-200 bg-background-light p-4 dark:border-white/10 dark:bg-background-dark">
<button @click="isSidebarOpen = true" class="flex h-10 w-10 items-center justify-center text-zinc-900 dark:text-white">
<span class="material-symbols-outlined">menu</span>
</button>
<h1 class="text-lg font-bold text-zinc-900 dark:text-white">Clientes</h1>
<a href="/admin/adicionar" class="flex h-10 w-10 items-center justify-center text-primary">
<span class="material-symbols-outlined !text-[28px]">add_circle</span>
</a>
</header>
<main class="flex-1">

<div class="p-4">
<div class="relative">
<span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400">search</span>
<input class="form-input w-full rounded-lg border-none bg-zinc-100 py-3 pl-10 pr-4 text-zinc-900 placeholder:text-zinc-500 focus:ring-2 focus:ring-primary dark:bg-primary-light dark:text-white dark:placeholder:text-zinc-400" 
                           placeholder="Buscar por telefone ou apelido..."
                           x-model.debounce.300ms="searchTerm" />
</div>
</div>

<div class="flex gap-2 overflow-x-auto px-4 pb-4">
<div class="relative">
<button @click="openProduto = !openProduto; openPeriodo = false; openStatus = false" type="button" class="flex shrink-0 items-center gap-2 rounded-full bg-zinc-100 px-4 py-2 text-sm font-medium text-zinc-900 dark:bg-primary-light dark:text-white">
<span x-text="filterProdutoText"></span>
<span class="material-symbols-outlined !text-[20px]">expand_more</span>
</button>
<div x-show="openProduto" @click.outside="openProduto = false" class="absolute top-full z-10 mt-2 w-48 rounded-lg bg-white shadow-lg dark:bg-primary-light" x-transition style="display: none;">
<a @click="filterProduto = 'todos'; filterProdutoText = 'Produto'; openProduto = false" class="block cursor-pointer px-4 py-2 text-sm text-zinc-700 hover:bg-zinc-100 dark:text-zinc-200 dark:hover:bg-primary-light/50">Todos os Produtos</a>
<a @click="filterProduto = 'chatgpt'; filterProdutoText = 'ChatGPT'; openProduto = false" class="block cursor-pointer px-4 py-2 text-sm text-zinc-700 hover:bg-zinc-100 dark:text-zinc-200 dark:hover:bg-primary-light/50">ChatGPT</a>
<a @click="filterProduto = 'canva_pro'; filterProdutoText = 'Canva Pro'; openProduto = false" class="block cursor-pointer px-4 py-2 text-sm text-zinc-700 hover:bg-zinc-100 dark:text-zinc-200 dark:hover:bg-primary-light/50">Canva Pro</a>
</div>
</div>
<div class="relative">
<button @click="openPeriodo = !openPeriodo; openProduto = false; openStatus = false" type="button" class="flex shrink-0 items-center gap-2 rounded-full bg-zinc-100 px-4 py-2 text-sm font-medium text-zinc-900 dark:bg-primary-light dark:text-white">
<span x-text="filterPeriodoText"></span>
<span class="material-symbols-outlined !text-[20px]">expand_more</span>
</button>
<div x-show="openPeriodo" @click.outside="openPeriodo = false" class="absolute top-full z-10 mt-2 w-48 rounded-lg bg-white shadow-lg dark:bg-primary-light" x-transition style="display: none;">
<a @click="filterPeriodo = 'todos'; filterPeriodoText = 'Período'; openPeriodo = false" class="block cursor-pointer px-4 py-2 text-sm text-zinc-700 hover:bg-zinc-100 dark:text-zinc-200 dark:hover:bg-primary-light/50">Todos os Períodos</a>
<a @click="filterPeriodo = 'monthly'; filterPeriodoText = 'Mensal'; openPeriodo = false" class="block cursor-pointer px-4 py-2 text-sm text-zinc-700 hover:bg-zinc-100 dark:text-zinc-200 dark:hover:bg-primary-light/50">Mensal</a>
<a @click="filterPeriodo = 'lifetime'; filterPeriodoText = 'Vitalício'; openPeriodo = false" class="block cursor-pointer px-4 py-2 text-sm text-zinc-700 hover:bg-zinc-100 dark:text-zinc-200 dark:hover:bg-primary-light/50">Vitalício</a>
</div>
</div>
<div class="relative">
<button @click="openStatus = !openStatus; openProduto = false; openPeriodo = false" type="button" class="flex shrink-0 items-center gap-2 rounded-full bg-zinc-100 px-4 py-2 text-sm font-medium text-zinc-900 dark:bg-primary-light dark:text-white">
<span x-text="filterStatusText"></span>
<span class="material-symbols-outlined !text-[20px]">expand_more</span>
</button>
<div x-show="openStatus" @click.outside="openStatus = false" class="absolute top-full z-10 mt-2 w-48 rounded-lg bg-white shadow-lg dark:bg-primary-light" x-transition style="display: none;">
<a @click="filterStatus = 'todos'; filterStatusText = 'Status'; openStatus = false" class="block cursor-pointer px-4 py-2 text-sm text-zinc-700 hover:bg-zinc-100 dark:text-zinc-200 dark:hover:bg-primary-light/50">Todos os Status</a>
<a @click="filterStatus = 'ativo'; filterStatusText = 'Ativo'; openStatus = false" class="block cursor-pointer px-4 py-2 text-sm text-zinc-700 hover:bg-zinc-100 dark:text-zinc-200 dark:hover:bg-primary-light/50">Ativo</a>
<a @click="filterStatus = 'inativo'; filterStatusText = 'Inativo'; openStatus = false" class="block cursor-pointer px-4 py-2 text-sm text-zinc-700 hover:bg-zinc-100 dark:text-zinc-200 dark:hover:bg-primary-light/50">Inativo</a>
</div>
</div>
</div>


<div class="flex flex-col gap-px divide-y divide-zinc-200 pb-28 dark:divide-white/10">
{% if not usuarios %}
<div class="p-8 text-center text-zinc-500 dark:text-zinc-400">
                Nenhum cliente ativo encontrado.
            </div>
{% endif %}

{% for usuario in usuarios %}
<div class="flex items-center gap-4 bg-background-light px-4 py-3 dark:bg-background-dark" 
     x-show="(searchTerm === '' || '{{ usuario.apelido }}'.toLowerCase().includes(searchTerm.toLowerCase()) || '{{ usuario.telefone }}'.includes(searchTerm.toLowerCase())) &&
             (filterProduto === 'todos' || '{{ usuario.produto.lower() }}'.includes(filterProduto.toLowerCase())) &&
             (filterPeriodo === 'todos' || '{{ usuario.periodo.lower() }}' === filterPeriodo.toLowerCase()) &&
             (filterStatus === 'todos' || '{{ usuario.status.lower() }}' === filterStatus.toLowerCase())
     "
     x-transition>
<img alt="Profile picture" class="h-14 w-14 shrink-0 rounded-full object-cover" src="https://ui-avatars.com/api/?name={{ usuario.apelido }}&background=d946ef&color=fff"/>
<div class="flex-1">
<p class="font-semibold text-zinc-900 dark:text-white">{{ usuario.apelido }}</p>

{% if usuario.status == 'ativo' and usuario.data_vencimento %}
    <p class="text-sm text-green-500">Vence em: {{ usuario.data_vencimento.strftime('%d/%m/%Y') }}</p>
{% elif usuario.status == 'ativo' and usuario.periodo == 'lifetime' %}
    <p class="text-sm font-semibold text-primary">Vitalício</p>
{% elif usuario.status == 'inativo' %}
    <p class="text-sm text-red-500">INATIVO (Cancelado)</p>
{% else %}
    <p class="text-sm text-yellow-500">Status: {{ usuario.status }}</p>
{% endif %}

<p class="text-sm text-zinc-500 dark:text-zinc-400">{{ usuario.telefone }} - {{ usuario.produto }}</p>
</div>
<div class="flex items-center gap-1">
{% if usuario.status == 'ativo' %}
    <div class="h-2 w-2 rounded-full bg-green-500"></div>
{% else %}
    <div class="h-2 w-2 rounded-full bg-red-500"></div>
{% endif %}
<button class="text-zinc-500 dark:text-zinc-400" 
                        @click="modalOpen = true; selectedUser = { id: {{ usuario.id }}, apelido: '{{ usuario.apelido }}', telefone: '{{ usuario.telefone }}', status: '{{ usuario.status }}' }">
<span class="material-symbols-outlined">more_vert</span>
</button>
</div>
</div>
{% endfor %} 

</div>
</main>
<div class="fixed bottom-0 left-0 right-0 z-20 border-t border-zinc-200 bg-background-light/80 p-4 backdrop-blur-sm dark:border-white/10 dark:bg-background-dark/80">
<a href="/admin/aviso-todos" class="flex w-full items-center justify-center gap-2 rounded-lg bg-primary py-3 text-white shadow-lg shadow-primary/30">
<span class="material-symbols-outlined">campaign</span>
<span class="text-base font-bold">Enviar Aviso para Todos</span>
</a>
</div>
</div>


<div class="fixed inset-0 z-30 flex items-end bg-black/50 backdrop-blur-sm" 
         x-show="modalOpen" 
         x-transition:enter="transition ease-out duration-300" 
         x-transition:enter-start="opacity-0" 
         x-transition:enter-end="opacity-100" 
         x-transition:leave="transition ease-in duration-200" 
         x-transition:leave-start="opacity-100" 
         x-transition:leave-end="opacity-0"
         style="display: none;"> 

<div class="w-full rounded-t-2xl bg-background-light shadow-2xl dark:bg-[#201821]"
             @click.outside="modalOpen = false"
             x-show="modalOpen"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 translate-y-full"
             x-transition:enter-end="opacity-100 translate-y-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 translate-y-0"
             x-transition:leave-end="opacity-0 translate-y-full">
<div class="mx-auto my-3 h-1 w-10 rounded-full bg-zinc-300 dark:bg-zinc-600"></div>
<div class="border-b border-zinc-200 px-4 pb-4" x-if="selectedUser">
<div class="flex items-center gap-4">
<img alt="Profile picture" class="h-14 w-14 rounded-full object-cover" :src="'https://ui-avatars.com/api/?name=' + selectedUser.apelido + '&background=d946ef&color=fff'"/>
<div>
<p class="text-lg font-bold text-zinc-900 dark:text-white" x-text="selectedUser.apelido"></p>
<p class="text-sm text-zinc-600 dark:text-zinc-400" x-text="selectedUser.telefone"></p>
</div>
</div>
</div>
<nav class="p-2" x-if="selectedUser">
<a class="flex items-center gap-4 rounded-lg px-2 py-3 hover:bg-zinc-100 active:bg-zinc-200 dark:hover:bg-primary-light/50 dark:active:bg-primary-light" :href="'/admin/adicionar-dias/' + selectedUser.id">
<span class="material-symbols-outlined text-primary">add</span>
<span class="text-zinc-900 dark:text-white">Adicionar dias</span>
</a>
<a class="flex items-center gap-4 rounded-lg px-2 py-3 hover:bg-zinc-100 active:bg-zinc-200 dark:hover:bg-primary-light/50 dark:active:bg-primary-light" 
   :href="'/admin/editar-datas/' + selectedUser.id">
<span class="material-symbols-outlined text-primary">edit_calendar</span>
<span class="text-zinc-900 dark:text-white">Editar datas</span>
</a>
<a class="flex items-center gap-4 rounded-lg px-2 py-3 hover:bg-zinc-100 active:bg-zinc-200 dark:hover:bg-primary-light/50 dark:active:bg-primary-light" 
   :href="'/admin/trocar-plano/' + selectedUser.id">
<span class="material-symbols-outlined text-primary">swap_horiz</span>
<span class="text-zinc-900 dark:text-white">Trocar produto/plano</span>
</a>
<a class="flex items-center gap-4 rounded-lg px-2 py-3 hover:bg-zinc-100 active:bg-zinc-200 dark:hover:bg-primary-light/50 dark:active:bg-primary-light" 
   :href="'/admin/toggle-status/' + selectedUser.id">
<span class="material-symbols-outlined text-primary" x-text="selectedUser.status === 'ativo' ? 'toggle_off' : 'toggle_on'"></span>
<span class="text-zinc-900 dark:text-white" x-text="selectedUser.status === 'ativo' ? 'Desativar (Retirar Produto)' : 'Ativar Usuário'"></span>
</a>
<a class="flex items-center gap-4 rounded-lg px-2 py-3 hover:bg-zinc-100 active:bg-zinc-200 dark:hover:bg-primary-light/50 dark:active:bg-primary-light" 
   :href="'/admin/detalhes/' + selectedUser.id">
<span class="material-symbols-outlined text-primary">visibility</span>
<span class="text-zinc-900 dark:text-white">Ver Detalhes (Leitura)</span>
</a>
<div class="my-1 border-t border-zinc-200 dark:border-white/10"></div>
<a class="flex items-center gap-4 rounded-lg px-2 py-3 hover:bg-zinc-100 active:bg-zinc-200 dark:hover:bg-primary-light/50 dark:active:bg-primary-light" 
   :href="'/admin/enviar-aviso/' + selectedUser.id">
<span class="material-symbols-outlined text-primary">campaign</span>
<span class="text-zinc-900 dark:text-white">Enviar aviso</span>
</a>
</nav>
<div class="h-4"></div>
</div>
</div>

<div x-show="isSidebarOpen" 
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-start="opacity-0"
     x-transition:enter-end="opacity-100"
     x-transition:leave="transition ease-in duration-200"
     x-transition:leave-start="opacity-100"
     x-transition:leave-end="opacity-0"
     class="fixed inset-0 z-30 bg-black/50 backdrop-blur-sm" 
     @click="isSidebarOpen = false"
     style="display: none;"></div>
<aside x-show="isSidebarOpen"
       x-transition:enter="transition ease-out duration-300"
       x-transition:enter-start="-translate-x-full"
       x-transition:enter-end="translate-x-0"
       x-transition:leave="transition ease-in duration-200"
       x-transition:leave-start="translate-x-0"
       x-transition:leave-end="-translate-x-full"
       class="fixed left-0 top-0 z-40 flex h-full w-72 flex-col border-r border-zinc-200 bg-background-light dark:border-white/10 dark:bg-background-dark"
       style="display: none;">
    <div class="flex items-center justify-between border-b border-zinc-200 p-4 dark:border-white/10">
        <h2 class="text-lg font-bold text-zinc-900 dark:text-white">Achadinhos Digitais</h2>
        <button @click="isSidebarOpen = false" class="text-zinc-500 dark:text-zinc-400">
            <span class="material-symbols-outlined">close</span>
        </button>
    </div>
    <nav class="flex-1 space-y-2 p-4">
        <a href="/admin/clientes" class="flex items-center gap-3 rounded-lg bg-primary/10 px-3 py-2 text-primary dark:bg-primary-light">
            <span class="material-symbols-outlined">group</span>
            <span class="font-medium">Clientes</span>
        </a>
        <a href="/admin/pendentes" class="flex items-center gap-3 rounded-lg px-3 py-2 text-zinc-700 hover:bg-zinc-100 dark:text-zinc-300 dark:hover:bg-primary-light/50">
            <span class="material-symbols-outlined">pending_actions</span>
            <span class="font-medium">Pendentes</span>
        </a>
        <a href="/admin/rejeitados" class="flex items-center gap-3 rounded-lg px-3 py-2 text-zinc-700 hover:bg-zinc-100 dark:text-zinc-300 dark:hover:bg-primary-light/50">
            <span class="material-symbols-outlined">person_off</span>
            <span class="font-medium">Rejeitados</span>
        </a>
        <a href="/admin/logs" class="flex items-center gap-3 rounded-lg px-3 py-2 text-zinc-700 hover:bg-zinc-100 dark:text-zinc-300 dark:hover:bg-primary-light/50">
            <span class="material-symbols-outlined">receipt_long</span>
            <span class="font-medium">Logs</span>
        </a>
    </nav>
    <div class="border-t border-zinc-200 p-4 dark:border-white/10">
        <a href="/logout" class="flex items-center gap-3 rounded-lg px-3 py-2 text-zinc-700 hover:bg-zinc-100 dark:text-zinc-300 dark:hover:bg-primary-light/50">
            <span class="material-symbols-outlined">logout</span>
            <span class="font-medium">Sair</span>
        </a>
    </div>
</aside>
</div> 
</body>
</html>